<h1>Vulnerability Management with OpenVAS</h1>
<h2>Description</h2>
In this project, I will set up an OpenVAS Vulnerability Management Scanner Virtual Machine in Azure. Then I develop a vulnerable Windows 10 Virtual Machine with outdated software and disabled security controls. Next, I perform unauthenticated and credentialed vulnerability scans using OpenVAS. Then I remediate the identified vulnerabilities. 
<br />


<h2>Environments Used </h2>

- <b>Azure</b>

<h2>Walkthrough:</h2>

Before starting the project, I want to mention that I created a free Azure Account for my previous lab project. I will be using the same Azure account for this project.

<h4>Preparing Vulnerability Scanner</h4>

First I login to my Azure portal and go to Azure Marketplace: <br />
<img src="https://i.imgur.com/Pf3zuG6.png" height="80%" width="80%" alt="Searching for Marketplace"/><br /><br />

Then I search for OpenVAS and select "OpenVAS secured and supported by HOSSTED:<br />

<img src="https://i.imgur.com/k83C3za.png" height="80%" width="80%" alt="Search OpenVAS"/><br /><br />

Then I select the pre-set configuration settings and select "Dev/Test" for the workload environment and "General Purpose" for workload type. After the selection, I click on continue to create VM:<br />
<img src="https://i.imgur.com/2G59KwD.png" height="80%" width="80%" alt="Search OpenVAS"/><br />
<img src="https://i.imgur.com/pdkhJz7.png" height="80%" width="80%" alt="Search OpenVAS"/><br /><br />

In the "Create a virtual machine" page, I edit the following details:<br />
<b>Resource Group</b>: "Vulnerability-Management" -> <i>Created new resource group</i><br />
<b>Virtual Machine Name</b>: "OpenVAS"<br />
<b>Region</b>: "East US 2"<br />
<b>Authentication Type</b>: "Password"<br />
<b>Username</b>: "cybersuhanlab"<br />
<b>Password</b>: "<i>Created a password</i>"<br />
<b>Confirm Password</b>: "<i>Retyped the password</i>"<br /><br />

Other than the above options, I left everything else to defaults. Then I clicked "Next: Disks". <br />
<img src="https://i.imgur.com/xeGJ9Bs.png" height="80%" width="80%" alt="VM Config 1"/><br />
<img src="https://i.imgur.com/ZfVhqPf.png" height="80%" width="80%" alt="VM Config 2"/><br />

I leave the Disks settings, Networking settings, and Management to default settings. I move on to "Monitoring" configuration. I disabled the Boot diagnostics in the Monitoring configuration. <br />
<img src="https://i.imgur.com/YKl1qJ6.png" height="80%" width="80%" alt="VM Config Monitoring"/><br /><br />

Once the Validation has passed, I click on "Create" to create the Virtual Machine. <br />
<img src="https://i.imgur.com/NOjMBlE.png" height="80%" width="80%" alt="VM Config Monitoring"/><br /><br />

<h4>SSH into the Vulnerability Management Server</h4>

Once the deployment of the Virtual Machine has finished, I go to the OpenVAS machine page in Azure portal. I copy the Public IP Address of my OpenVAS Virtual Machine:<br />
<img src="https://i.imgur.com/Tk0uZoq.png" height="80%" width="80%" alt="VM IP Address"/><br /><br />

I SSH into my OpenVAS Virtual Machine using Powershell:<br />
<img src="https://i.imgur.com/bwmSsa7.png" height="80%" width="80%" alt="SSH into VM"/><br /><br />

I can see the link to the Web Portal in my Powershell SSH terminal. I open the portal URL in my browser. The default username is "admin: and the password is also "admin". After logging in, I can see the dashboard. I make sure the first thing I do after logging in to the dashboard is change the password to something secure. :<br />
<img src="https://i.imgur.com/F0NZL8c.png" height="80%" width="80%" alt="Web Portal URL"/><br />
<img src="https://i.imgur.com/gU7RgBp.png" height="80%" width="80%" alt="Opening Web Portal in Browser"/><br />
<img src="https://i.imgur.com/dRoQcKT.png" height="80%" width="80%" alt="Dashboard"/><br /><br />

<h4>Creating a <i>Vulnerable</i> Virtual Machine</h4>

Now, I need to create a vulnerable virtual machine in Azure. I go back to Azure portal and create a new virtual machine with the following configurations:<br />
<b>Resource Group</b>: "Vulnerability-Management" -><i>Same as the OpenVAS resource group</i><br />
<b>Virtual machine name</b>: "Windows10-Vulnerable"<br />
<b>Region</b>: "East US 2" -> <i>Same as the OpenVAS VM</i><br />
<b>Image</b>: "Windows 10 Pro, version 22H2 - x64 Gen2"<br />
<b>Size</b>: "Standard_E2s_v3 - 2 vcpus, 16GiB memory" -> <i>I selected the cheapest one with at least 2 Virtual CPUs</i><br />
<b>Username</b></n>: "cybersuhanlab"<br />

<img src="https://i.imgur.com/57JbSx4.png" height="80%" width="80%" alt="VM Settings Vulnerable"/><br /><br />

Next, I go into Network settings and make sure that the Virtual Network is the same one as I used for the OpenVAS. I just clicked Review and Create and Created a new VM.<br />
<img src="https://i.imgur.com/4jBlAqP.png" height="80%" width="80%" alt="Vulnerable VM Network"/><br /><br />

After the Virtual Machine is created, I will go to the Windows10-Vulnerable VM page in Azure Portal to copy the Public IP Address of the VM. This IP Address will be used for Remote Connection to the Windows10-Vulnerable VM. I enter the Username and Password I created while configuring the VM.<br />
<img src="https://i.imgur.com/A6Wj4Jc.png" height="80%" width="80%" alt="Vulnerable VM Network"/><br />
<img src="https://i.imgur.com/pjDOYp6.png" height="80%" width="80%" alt="Vulnerable VM Network"/><br /><br />

Now That I am logged into the VM, I want to make it vulnerable. To do that, I take the following steps:<br />

1. Disable the Firewall<br />
2. Install old versions of software:<br />
   - Adobe Reader<br />
   - Firefox<br />
   - VLC Player<br />
3. Restart the VM<br />

<img src="https://i.imgur.com/vX36vHj.png" height="80%" width="80%" alt="Vulnerable VM Network"/><br />
<img src="https://i.imgur.com/366IzK7.png" height="80%" width="80%" alt="Vulnerable VM Network"/><br />
<img src="https://i.imgur.com/o6RYpS6.png" height="80%" width="80%" alt="Vulnerable VM Network"/><br />
<img src="https://i.imgur.com/WvDxDkw.png" height="80%" width="80%" alt="Vulnerable VM Network"/><br /><br />

<b><i>At this point, The Windows 10 Machine is Vulnerable and ready to be scanned.</i></b>

<h4>Configure OpenVAS and perform First Unauthenticated Scan</h4>
<i>The Unauthenticated Scan means that the OpenVAS will not log on to the vulnerable machine and scan it from a superficial level. I will first do the unauthenticated scan before doing the authenticated scan for comparison.</i> <br />

To start, I log in to the OpenVAS web portal in an <b>Incognito/Private</b> Window. <br />
<img src="https://i.imgur.com/WvDxDkw.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

I go to Assets -> Hosts to get to the Hosts page. I click on the "Add New Host" icon. I find the private IP Address of the Windows10-Vulnerable VM and use it in the OpenVAS New host creation window: <br />
<img src="https://i.imgur.com/zDwRJOr.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />
<img src="https://i.imgur.com/7aWAOK9.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />
<img src="https://i.imgur.com/dDoS6X5.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

The next thing that I do is create a new target from the host. I name the target as Azure Win10 Vulnerable VM. <br />
<img src="https://i.imgur.com/OQmymyg.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />
<img src="https://i.imgur.com/Wvtmn5G.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

Now, I need to create a new task for the scan. So, I go into Scans -> Tasks. Then I create a new task. I name the task as "Scan-Azure-Win10Vulnerable and select the "Azure Win10 Vulnerable VM" as Scan Target which I just created. <br />

<img src="https://i.imgur.com/sydE78f.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />
<img src="https://i.imgur.com/m6gXyTv.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />
<img src="https://i.imgur.com/2pFOC27.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

I will now start scanning with the little <i>Play</i> button.<br />
<img src="https://i.imgur.com/iV88u9H.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

After the scan is complete, I click on the Date of the Last Report column. <br />

<img src="https://i.imgur.com/4mTUj3w.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

The scan report has different tabs. The results tab shows the different vulnerabilities found. I don't see any installed software here because this scan was an unauthenticated scan. I expect to see more vulnerabilities when I start an authenticated scan.<br />
<img src="https://i.imgur.com/XfaiozB.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

In the unauthenticated scan report, The scanner cannot log in and get the full details of vulnerabilities and has a limited capacity for identifying vulnerabilities. <br /><br />

<h4>Configuring Vulnerable Windows 10 for Authorized Scans</h4>
To start an authenticated scan, I have to make some configuration modifications in the Windows10-Vulnerable Virtual Machine. I will make the following changes in the Windows10-Vulnerable VM:<br />
- Disable User Account Control<br />
- Enable Remote Registry<br />
- Allow non-administrator account to make changes in the Registry<br />

Disabling User Account Control:<br />
<img src="https://i.imgur.com/L3ZYU1A.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />


Enabling Remote Registry Services:<br />
<img src="https://i.imgur.com/ZDFnA6S.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />
<img src="https://i.imgur.com/vYdKVB2.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

Next, I open the <b>Registry Editor</b> in the Windows10-Vulnerable Machine and go to  <b><i>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</i></b><br />
I add a new <b>DWORD(32-bit)</b> value and set the value to <i>1</i><br />

<img src="https://i.imgur.com/NPdHKSO.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />
<img src="https://i.imgur.com/w22DPaf.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

After these configurations, I restart the VM to make sure that the configurations are saved.

<h4>Configuring OpenVAS for Credentialed Scan</h4>
Next, I need to configure OpenVAS to run authorized scans. As for configuration, I take the following steps:<br />
- Create a new credential in the OpenVAS web portal<br />
- Clone the Windows 10 target that I made previously<br /><br />

To create a New Credential, I go to <i>Configurations</i> -> <i>Credentials</i> and Click <i>New Credential</i><br />
<img src="https://i.imgur.com/rgBqTRN.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

I enter my Windows10-Vulnerable VM credentials and save it as "Azure Win10 Vulnerable VM Credentials". I also allow insecure use. I save the credentials in OpenVAS.<br />
<img src="https://i.imgur.com/4aYS4YL.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

Next, I go to <i>Configuration</i> -> <i>Targets</i> and clone the previously made target by clicking on the <i>Sheep</i> icon:<br />
<img src="https://i.imgur.com/8r6zQln.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />
<img src="https://i.imgur.com/aMLmfJF.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

I edit the configuration of the cloned Target and name it "Azure Win10 Vulnerable VM - Credentialed Scan". Then I change the credentials for SMB and select "Azure Win10-Vulnerable" (The credentials I created in the previous step)
<img src="https://i.imgur.com/lfoFwcA.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

At this point, OpenVAS is configured for a credentialed scan.

<h4>Execute Credentialed Scan</h4>
To execute the credentialed scan, I clone the task that I created previously by going to <i>Scans</i> -> <i>Tasks</i> and cloning the previously created scan with the <i>Sheep icon</i>. Then I edit the cloned task and update the following details:<br />
<b>Name</b>: "Scan-Azure-Win10Vulnerable -Credentialed"<br />
<b>Scan Targets</b>: "Azure Win10 Vulnerable VM - Credentialed Scan" -> <i>Created in previous step</i><br />
I leave the rest of the configurations as default and save the configuration. <br />
<img src="https://i.imgur.com/kXz90Xj.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

Now that I have the new scan task configured, I press the <i>Play</i> button to start the scan. <br />
<img src="https://i.imgur.com/Z6jTfZb.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

After the scan, I can see that the severity is already at High:<br />
<img src="https://i.imgur.com/ypJhAla.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

I open the results and can see a list of vulnerabilities that the scanner could find.: <br />
<img src="https://i.imgur.com/4998VIF.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br /><br />

The authorized scan is very detailed in comparison to the unauthorized scans. OpenVAS also gives the option to download the reports (which I attached to this repository). 

<h4>Mitigation of Vulnerabilities</h4>
After the vulnerability scan, the final part of this project is to remediate the vulnerabilities. The vulnerabilities exist because I installed 3 outdated software, which is what the reports suggest. Therefore, to start mitigation, I will uninstall the software: <br />
<img src="https://i.imgur.com/CIky2ZH.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />
<img src="https://i.imgur.com/pcpFKIn.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />
After the uninstallation, I restart the VM and wait for about 5 minutes to start scanning again.<br />

I rescan the credentialed scan again:<br />
<img src="https://i.imgur.com/7vU87oy.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />

After the scan, the trend of vulnerabilities shows a drop:<br />
<img src="https://i.imgur.com/dVoiSY6.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />

I open the report which shows just very few vulnerabilities:<br />
<img src="https://i.imgur.com/H2P8S85.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />

Some vulnerabilities like IExpress Search Path Vulnerability have a workaround solution, which the report also mentions. The report shows insight, detection method, impact and solutions to the vulnerabilities.  
<img src="https://i.imgur.com/bjE0e8i.png" height="80%" width="80%" alt="Vulnerable VM in incognito"/><br />

<h4>Conclusion</h4>
This concludes the OpenVAS Vulnerability Management project. All the reports generated by OpenVAS portal is uploaded to this repository for anyone who wants to check them out. I also removed the resource group and virtual machines from my Azure portal as they cost money in my pay-as-you-go subscription.












<!--
 ```diff
- text in red
+ text in green
! text in orange
# text in gray
@@ text in purple (and bold)@@
```
--!>
